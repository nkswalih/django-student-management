{% load static %}
{% load crispy_forms_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Student Registration Page 2026">
    <title>Student Registration</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js (Handles the Next/Back logic) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                fontFamily: { sans: ['Inter', 'sans-serif'] },
                extend: {
                    colors: {
                        primary: { 500: '#3b82f6', 600: '#2563eb' }
                    }
                }
            }
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        /* Smooth fade for steps */
        .step-content { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 flex items-center justify-center min-h-screen p-4">

    <!-- Card Container -->
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden flex flex-col max-h-[90vh]" 
         x-data="registrationWizard()">
        
        <!-- Header & Progress -->
        <div class="bg-white p-6 border-b border-slate-100 z-10">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-xl font-bold text-slate-900">Student Registration</h1>
                    <p class="text-sm text-slate-500">Step <span x-text="step"></span> of 3</p>
                </div>
                <!-- Step Indicator Circles -->
                <div class="flex gap-2">
                    <template x-for="i in 3">
                        <div class="w-2.5 h-2.5 rounded-full transition-colors duration-300"
                             :class="step >= i ? 'bg-primary-600' : 'bg-slate-200'"></div>
                    </template>
                </div>
            </div>
            
            <!-- Progress Bar Line -->
            <div class="h-1 w-full bg-slate-100 rounded-full overflow-hidden">
                <div class="h-full bg-primary-600 transition-all duration-500 ease-out" 
                     :style="'width: ' + ((step / 3) * 100) + '%'"></div>
            </div>
        </div>

        <!-- Scrollable Form Area -->
        <div class="flex-1 overflow-y-auto p-6 md:p-8 custom-scrollbar">
            <form method="post" enctype="multipart/form-data" id="regForm">
                {% csrf_token %}

                <!-- STEP 1: Personal & Photo -->
                <div x-show="step === 1" class="step-content space-y-6">
                    <h2 class="text-lg font-semibold text-slate-800">Personal Details</h2>
                    
                    <!-- Profile Picture Upload (Centered) -->
                    <div class="flex flex-col items-center justify-center mb-6">
                        <div class="relative group cursor-pointer">
                            <!-- Image Preview -->
                            <img id="imgPreview" 
                                 src="https://via.placeholder.com/150?text=Upload+Photo" 
                                 class="w-28 h-28 rounded-full object-cover border-4 border-slate-50 shadow-lg group-hover:border-primary-100 transition-all">
                            
                            <!-- Camera Icon Overlay -->
                            <div class="absolute bottom-0 right-0 bg-primary-600 p-2 rounded-full text-white shadow-md group-hover:bg-primary-700 transition-colors pointer-events-none">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            </div>
                            
                            <!-- Actual File Input -->
                            <input type="file" name="profile_picture" id="{{ form.profile_picture.id_for_label }}" 
                                   class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                   accept="image/*" onchange="readURL(this);">
                        </div>
                        <span class="text-xs text-slate-400 mt-2">Click to upload (Max 2MB)</span>
                    </div>

                    <!-- Personal Fields Grid -->
                    <div class="grid grid-cols-2 md:grid-cols-2 gap-5">
                        <div class="col-span-1">{{ form.first_name|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.last_name|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.email|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.phone|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.date_of_birth|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.gender|as_crispy_field }}</div>
                    </div>
                </div>

                <!-- STEP 2: Academic Info -->
                <div x-show="step === 2" x-cloak class="step-content space-y-6">
                    <h2 class="text-lg font-semibold text-slate-800">Academic Information</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                        <div class="col-span-2">{{ form.reg_number|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.department|as_crispy_field }}</div>
                        <div class="col-span-1">{{ form.year_of_admission|as_crispy_field }}</div>
                        <div class="col-span-2">{{ form.course|as_crispy_field }}</div>
                    </div>
                </div>

                <!-- STEP 3: Security & Submit -->
                <div x-show="step === 3" x-cloak class="step-content space-y-6">
                    <h2 class="text-lg font-semibold text-slate-800">Security & Privacy</h2>

                    <div class="space-y-4">
                        {{ form.password|as_crispy_field }}
                        {{ form.confirm_password|as_crispy_field }}
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 flex gap-3 items-start mt-4">
                        <input type="checkbox" required class="mt-1 rounded text-primary-600 focus:ring-primary-500">
                        <p class="text-sm text-blue-800">
                            I accept the <a href="#" class="font-semibold underline">Terms & Conditions</a> and certify that the information provided is correct.
                        </p>
                    </div>
                    
                    <!-- Submit Button (Only visible on Step 3) -->
                    <button type="submit" 
                        class="w-full mt-6 bg-primary-600 text-white font-semibold py-3 rounded-xl shadow-lg shadow-primary-500/30 hover:bg-primary-700 hover:shadow-primary-500/40 transition-all duration-200 transform hover:-translate-y-0.5">
                        Complete Registration
                    </button>
                </div>
            </form>
        </div>

        <!-- Footer Navigation (Back / Next) -->
        <div class="bg-slate-50 p-4 border-t border-slate-200 flex justify-between items-center">
            
            <!-- Back Button -->
            <button type="button" x-show="step > 1" @click="step--" 
                    class="text-slate-600 font-medium px-4 py-2 hover:bg-white hover:shadow-sm rounded-lg transition">
                Back
            </button>
            <div x-show="step === 1"></div> <!-- Spacer -->

            <!-- Next Button (Hidden on Step 3) -->
            <button type="button" x-show="step < 3" @click="validateAndNext()" 
                    class="bg-slate-900 text-white font-medium px-6 py-2.5 rounded-lg hover:bg-slate-800 flex items-center gap-2 transition">
                Next Step
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
            </button>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        function registrationWizard() {
            return {
                step: 1,
                validateAndNext() {
                    // Get current step inputs
                    const inputs = document.querySelectorAll(`[x-show="step === ${this.step}"] input, [x-show="step === ${this.step}"] select`);
                    let isValid = true;
                    
                    // Simple HTML5 Validation Check
                    inputs.forEach(input => {
                        if (!input.checkValidity()) {
                            input.reportValidity();
                            isValid = false;
                        }
                    });

                    if (isValid) {
                        this.step++;
                    }
                }
            }
        }

        // Image Preview Script
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('imgPreview').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</body>
</html>